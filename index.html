<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/sample.css">
    <title>Jank</title>
</head>

<body>
    <header>
        <img src="img/junk_logo.png" alt="イメージロゴ">
        グーチョキパーボタンで単発ジャンケン/オートで複数回ジャンケン <br>
        簡単操作で設定できる、多彩なストラテジー(※)を駆使して相手を打ち負かそう <br>
        (※)機能は今後のアップデートで対応予定となります
        <img src="img/junk_logo.png" alt="イメージロゴ">
    </header>

    <main>
        <ul class='mainBtn'>
            <li id="gu_btn">グー</li>
            <li id="cho_btn">チョキ</li>
            <li id="par_btn">パー</li>
            <li id="auto_btn">オート</li>
        </ul>

        <div class='simpleJankenArea'>
            <div>勝敗</div>
            <div id="judgment"></div>
        </div>

        <div class='resultArea'>
            <table class='myResultArea'>
                <tr>
                    <td>Player1 Name</td>
                </tr>
                <tr>
                    <td>
                        <input type="text" id="player1Name">
                    </td>
                </tr>
                <tr>
                    <td>ー</td>
                    <td class='myResultNoArea'></td>
                </tr>
                <tr>
                    <td>自分の手</td>
                    <td class='myResultNoArea' id="jibun"></td>
                </tr>
                <tr>
                    <td>グー数</td>
                    <td class='myResultNoArea' id="my_numOfHandKind_Gu_ID">0</td>
                </tr>
                <tr>
                    <td>チョキ数</td>
                    <td class='myResultNoArea' id="my_numOfHandKind_Choki_ID">0</td>
                </tr>
                <tr>
                    <td>パー数</td>
                    <td class='myResultNoArea' id="my_numOfHandKind_Par_ID">0</td>
                </tr>
                <tr>
                    <td>勝ち数</td>
                    <td class='myResultNoArea' id="my_numOfJudge_Win_ID">0</td>
                </tr>
                <tr>
                    <td>負け数</td>
                    <td class='myResultNoArea' id="my_numOfJudge_Loss_ID">0</td>
                </tr>
                <tr>
                    <td>あいこ数</td>
                    <td class='myResultNoArea' id="my_numOfJudge_Even_ID">0</td>
                </tr>
                <tr>
                    <td>直近コンボ</td>
                    <td class='myResultNoArea' id="my_numOfLastCombo_ID">0</td>
                </tr>
                <tr>
                    <td>最大コンボ</td>
                    <td class='myResultNoArea' id="my_numOfMaxCombo_ID">0</td>
                </tr>
                <tr>
                    <td>ポイント</td>
                    <td class='myResultNoArea' id="my_nomalPoint_ID">0</td>
                </tr>
                <tr>
                    <td>コンボボーナス</td>
                    <td class='myResultNoArea' id="my_comboPoint_ID">0</td>
                </tr>
                <tr>
                    <td>合計ポイント</td>
                    <td class='myResultNoArea' id="my_pointSum_ID">0</td>
                </tr>
                <tr>
                    <td>ー</td>
                    <td class='myResultNoArea'></td>
                </tr>
                <tr>
                    <td>データ分析</td>
                    <td class='myResultNoArea'></td>
                </tr>
                <tr>
                    <td>グー率</td>
                    <td class='myResultNoArea' id="my_ratioOfHandKind_Gu_ID">0</td>
                </tr>
                <tr>
                    <td>チョキ率</td>
                    <td class='myResultNoArea' id="my_ratioOfHandKind_Choki_ID">0</td>
                </tr>
                <tr>
                    <td>パー率</td>
                    <td class='myResultNoArea' id="my_ratioOfHandKind_Par_ID">0</td>
                </tr>
                <tr>
                    <td>勝ち率</td>
                    <td class='myResultNoArea' id="my_ratioOfJudge_Win_ID">0</td>
                </tr>
                <tr>
                    <td>負け率</td>
                    <td class='myResultNoArea' id="my_ratioOfJudge_Loss_ID">0</td>
                </tr>
                <tr>
                    <td>あいこ率</td>
                    <td class='myResultNoArea' id="my_ratioOfJudge_Even_ID">0</td>
                </tr>
                <tr>
                    <td>コンボボーナス率</td>
                    <td class='myResultNoArea' id="my_ratioOfcomboPoint_ID">0</td>
                </tr>
            </table>


            <div class r='esultGraph'>
                <div class='resultGraphArea'>勝敗データ
                    <canvas id="myChart"></canvas>
                </div>
                <div class='resultGraphArea'>勝敗割合
                    <canvas id="myChart2"></canvas>
                </div>
            </div>


            <table class='yourResultArea'>
                <tr>
                    <td class='yourResultNoArea' </td>
                    <td>Player2 Name</td>
                </tr>
                <tr>

                    <td class='yourResultNoArea'></td>
                    <td>
                        <input type="text" id="player2Name">
                    </td>
                </tr>
                <tr>
                    <td class='yourResultNoArea'></td>
                    <td class='yourResultTxtArea'>ー</td>
                </tr>
                <tr>
                    <td class='yourResultNoArea' id="aite"></td>
                    <td class='yourResultTxtArea'>相手の手</td>
                </tr>
                <tr>
                    <td class='yourResultNoArea' id="your_numOfHandKind_Gu_ID">0</td>
                    <td class='yourResultTxtArea'>グー数</td>
                </tr>
                <tr>
                    <td class='yourResultNoArea' id="your_numOfHandKind_Choki_ID">0</td>
                    <td class='yourResultTxtArea'>チョキ数</td>
                </tr>
                <tr>
                    <td class='yourResultNoArea' id="your_numOfHandKind_Par_ID">0</td>
                    <td class='yourResultTxtArea'>パー数</td>
                </tr>
                <tr>
                    <td class='yourResultNoArea' id="your_numOfJudge_Win_ID">0</td>
                    <td class='yourResultTxtArea'>勝ち数</td>
                </tr>
                <tr>
                    <td class='yourResultNoArea' id="your_numOfJudge_Loss_ID">0</td>
                    <td class='yourResultTxtArea'>負け数</td>
                </tr>
                <tr>
                    <td class='yourResultNoArea' id="your_numOfJudge_Even_ID">0</td>
                    <td class='yourResultTxtArea'>あいこ数</td>
                </tr>
                <tr>
                    <td class='yourResultNoArea' id="your_numOfLastCombo_ID">0</td>
                    <td class='yourResultTxtArea'>直近コンボ</td>
                </tr>
                <tr>
                    <td class='yourResultNoArea' id="your_numOfMaxCombo_ID">0</td>
                    <td class='yourResultTxtArea'>最大コンボ</td>
                </tr>
                <tr>
                    <td class='yourResultNoArea' id="your_nomalPoint_ID">0</td>
                    <td class='yourResultTxtArea'>ポイント</td>
                </tr>
                <tr>
                    <td class='yourResultNoArea' id="your_comboPoint_ID">0</td>
                    <td class='yourResultTxtArea'>コンボボーナス</td>
                </tr>
                <tr>
                    <td class='yourResultNoArea' id="your_pointSum_ID">0</td>
                    <td class='yourResultTxtArea'>ポイント合計</td>
                </tr>
                <tr>
                    <td class='yourResultNoArea'></td>
                    <td class='yourResultTxtArea'>ー</td>
                </tr>
                <tr>
                    <td class='yourResultNoArea'></td>
                    <td class='yourResultTxtArea'>データ分析</td>
                </tr>
                <tr>
                    <td class='yourResultNoArea' id="your_ratioOfHandKind_Gu_ID">0</td>
                    <td class='yourResultTxtArea'>グー率</td>
                </tr>
                <tr>
                    <td class='yourResultNoArea' id="your_ratioOfHandKind_Choki_ID">0</td>
                    <td class='yourResultTxtArea'>チョキ率</td>
                </tr>
                <tr>
                    <td class='yourResultNoArea' id="your_ratioOfHandKind_Par_ID">0</td>
                    <td class='yourResultTxtArea'>パー率</td>
                </tr>
                <tr>
                    <td class='yourResultNoArea' id="your_ratioOfJudge_Win_ID">0</td>
                    <td class='yourResultTxtArea'>勝ち率</td>
                </tr>
                <tr>
                    <td class='yourResultNoArea' id="your_ratioOfJudge_Loss_ID">0</td>
                    <td class='yourResultTxtArea'>負け率</td>
                </tr>
                <tr>
                    <td class='yourResultNoArea' id="your_ratioOfJudge_Even_ID">0</td>
                    <td class='yourResultTxtArea'>あいこ率</td>
                </tr>
                <tr>
                    <td class='yourResultNoArea' id="your_ratioOfcomboPoint_ID">0</td>
                    <td class='yourResultTxtArea'>コンボボーナス率</td>
                </tr>
            </table>

    </main>

    <footer>
        <div class="rankingSnd">
            <a href="" class="rankingSndBtn" class="js-modal-open" id='ranking'>ランキングを見る</a>
        </div>

        <!-- <div class="content">
            <a class="js-modal-open" href="">クリックでモーダルを表示</a>
        </div> -->
        <div class="modal js-modal">
            <div class="modal__bg js-modal-close"></div>
            <div class="modal__content">
                <p>1.</p>
                <p id='rank1_userName'></p>
                <p id='rank1_totalScore'></p>
                <p>2.</p>
                <p id='rank2_userName'></p>
                <p id='rank2_totalScore'></p>

                <!-- <tr>
                    <th>ランク</th>
                    <th>プレイヤー</th>
                    <th>トータルスコア</th>
                </tr>
                <tr>
                    <td>1.</td>
                    <td id='rank1_userName'></td>
                    <td id='rank1_totalScore'></td>
                </tr>
                <tr>
                    <td>2.</td>
                    <td id='rank2_userName'></td>
                    <td id='rank_totalScore'></td>
                </tr>
                <tr>
                    <td>3.</td>
                    <td></td>
                    <td></td>
                </tr> -->

                <p>ウィンドウを閉じる場合は下の「閉じる」をクリックするか、背景の黒い部分をクリックしても閉じることができます。</p>
                <a class="js-modal-close" href="">閉じる</a>
            </div>
            <!--modal__inner-->
        </div>
        <!--modal-->
    </footer>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.min.js"></script>

    <script>
        /********************************
         * 定数定義
         ********************************/

        //ループ回数
        const JANKEN_ROOP_MAX = 100;

        // グーチョキパー
        const JANKEN_HAND_GU = 0;
        const JANKEN_HAND_CHOKI = 1;
        const JANKEN_HAND_PAR = 2;

        // 文字列変換表
        const JANKEN_HAND_TEXT_MTX = [
            'グー',
            'チョキ',
            'パー'
        ];

        //勝ち負けあいこ
        const JANKEN_JUDGE_WIN = 0;
        const JANKEN_JUDGE_LOSS = 1;
        const JANKEN_JUDGE_DRAW = 2;

        // 文字列変換表
        const JANKEN_JUDGE_TEXT_MTX = [
            'かち',
            'まけ',
            'あいこ'
        ];

        // 勝ち負け判定マトリックス
        // 1次元目:自分の手  2次元目:相手の手
        const JANKEN_JUDGE_MTX = [
            // 相手がグー,チョキ,パー
            [JANKEN_JUDGE_DRAW, JANKEN_JUDGE_WIN, JANKEN_JUDGE_LOSS],   //自分がグー
            [JANKEN_JUDGE_LOSS, JANKEN_JUDGE_DRAW, JANKEN_JUDGE_WIN],   //自分がチョキ
            [JANKEN_JUDGE_WIN, JANKEN_JUDGE_LOSS, JANKEN_JUDGE_DRAW]    //自分がパー
        ];

        //IDの連想配列
        const ID_TO_JANKEN_HAND = {
            // なぜか直打ちじゃないと動かない
            '#gu_btn': JANKEN_HAND_GU,
            '#cho_btn': JANKEN_HAND_CHOKI,
            '#par_btn': JANKEN_HAND_PAR
        };
        //乱数のパラメータ
        const min = 0;
        const max = 2;
    </script>

    <script>
        /********************************
         * グラフを書く
         ********************************/
        var ctx = document.getElementById('myChart').getContext('2d');
        var chart = new Chart(ctx, {
            // 作成したいチャートのタイプ
            type: 'bar',

            // データセットのデータ
            data: {
                labels: ["グー", "チョキ", "パー", "勝ち", "負け", "あいこ", "PT", "CMB", "SUM"],
                datasets: [
                    {
                        label: "自分",
                        backgroundColor: 'rgb(00, 128, 00)',
                        borderColor: 'rgb(255, 99, 132)',
                        data: [0, 0, 0, 0, 0, 0, 0, 0, 0],
                    }, {
                        label: "相手",
                        backgroundColor: 'rgb(255, 0, 132)',
                        borderColor: 'rgb(255, 0, 132)',
                        data: [0, 0, 0, 0, 0, 0, 0, 0, 0],
                    }
                ]
            },

            // ここに設定オプションを書きます
            options: {}
        });

        var ctx = document.getElementById('myChart2').getContext('2d');
        var chart2 = new Chart(ctx, {
            // 作成したいチャートのタイプ
            type: 'bar',

            // データセットのデータ
            data: {
                labels: ["グー率", "チョキ率", "パー率", "勝ち率", "負け率", "あいこ率"],
                datasets: [
                    {
                        label: "自分",
                        backgroundColor: 'rgb(00, 128, 00)',
                        borderColor: 'rgb(255, 99, 132)',
                        data: [0, 0, 0, 0, 0, 0],
                    }, {
                        label: "相手",
                        backgroundColor: 'rgb(255, 0, 132)',
                        borderColor: 'rgb(255, 0, 132)',
                        data: [0, 0, 0, 0, 0, 0],
                    }
                ]
            },

            // ここに設定オプションを書きます
            options: {}
        });
    </script>

    <script>
        /********************************
         * 共通関数
         ********************************/

        /********************************
         * スリープ関数
         * @param in ms  ミリセカンド
         ********************************/
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        /********************************
         * 自分の手の表記を変える関数
         * @param in inputId  ジャンケンの手
         * @param in outputId 書き変える対象のID
         ********************************/
        function jibunIdToJankenHand(jankenHand, outputId) {
            let jankenTxt = JANKEN_HAND_TEXT_MTX[jankenHand]    //入力されたジャンケンの数値をテキストに変える
            $(outputId).text(jankenTxt);
            return;
        }

        /********************************
         * 相手の手の表記を変える関数
         * @param in jankenHand  ジャンケンの手
         * @param in outputId 書き変える対象のID
         ********************************/
        function aiteIdToJankenHand(jankenHand, outputId) {
            let jankenTxt = JANKEN_HAND_TEXT_MTX[jankenHand]    //入力されたジャンケンの数値をテキストに変える
            $(outputId).text(jankenTxt);
            return;
        }

    </script>

    <script>
        /********************************
         * オート機能
         ********************************/
        $(function () {
            $('#auto_btn').on('click', function () {


                //自分用集計データ
                let my_numOfHandKind = [0, 0, 0];    //グー、チョキ、パーを出した数
                let my_numOfJudge = [0, 0, 0];       //勝ち、負け、あいこになった数
                let my_numOfLastCombo = 0;           //直近の連勝数
                let my_numOfMaxCombo = 0;            //最大連勝数
                let my_nomalPoint = 0;               //通常ポイント
                let my_comboPoint = 0;               //連勝ポイント

                //相手用集計データ
                let your_numOfHandKind = [0, 0, 0];  //グー、チョキ、パーを出した数
                let your_numOfJudge = [0, 0, 0];     //勝ち、負け、あいこになった数
                let your_numOfLastCombo = 0;         //直近の連勝数
                let your_numOfMaxCombo = 0;          //最大連勝数
                let your_nomalPoint = 0;             //通常ポイント
                let your_comboPoint = 0;             //連勝ポイント

                //クリックされたIDを求める
                clickID = '#' + $(this).attr("id");
                //デバッグ出力
                console.log('id  ' + clickID);

                //自動でジャンケンを繰り返す
                (async () => {
                    //デバッグ出力
                    for (let JankCount = 1; JankCount <= JANKEN_ROOP_MAX; JankCount++) {

                        //0-2の乱数をJANKEN_HANDとし、それをもとに自分の出した手の表記を変える
                        let myHand = Math.floor(Math.random() * (max - min + 1)) + min;
                        jibunIdToJankenHand(myHand, '#jibun');

                        //0-2の乱数をJANKEN_HANDとし、それをもとに相手の出した手の表記を変える
                        let yourHand = Math.floor(Math.random() * (max - min + 1)) + min;
                        aiteIdToJankenHand(yourHand, '#aite')

                        //勝敗判定
                        let myJudeCode = JANKEN_JUDGE_MTX[myHand][yourHand];
                        let myJudge = JANKEN_JUDGE_TEXT_MTX[myJudeCode];
                        let yourJudgeCode = JANKEN_JUDGE_MTX[yourHand][myHand];
                        let yourJudge = JANKEN_JUDGE_TEXT_MTX[yourJudgeCode];
                        $('#judgment').text(myJudge);

                        //自分用集計データ
                        my_numOfHandKind[myHand] += 1;    //グー、チョキ、パーを出した数
                        my_numOfJudge[myJudeCode] += 1;      //勝ち、負け、あいこになった数

                        //勝ちの場合の一連の処理
                        if (myJudeCode == JANKEN_JUDGE_WIN) {

                            //直近連勝数を更新し直近連勝数が最大連勝数を超えるようなら
                            //最大連勝数の更新
                            my_numOfLastCombo += 1;
                            if (my_numOfLastCombo > my_numOfMaxCombo) {
                                my_numOfMaxCombo = my_numOfLastCombo;
                            }
                            //通常ポイントアップ
                            my_nomalPoint += 1;
                            //連勝ポイントアップ
                            if (my_numOfLastCombo > 1) {
                                my_comboPoint += my_numOfLastCombo;
                                // my_comboPoint += 1;
                            }

                        }
                        //負けの場合の一連の処理
                        else if (myJudeCode == JANKEN_JUDGE_LOSS) {
                            //直近連勝数のリセット
                            my_numOfLastCombo = 0;

                        }
                        //あいこの場合の一連の処理
                        else if (myJudeCode == JANKEN_JUDGE_DRAW) {
                            //直近連勝数のリセット
                            my_numOfLastCombo = 0;
                        }

                        //相手用集計データ
                        your_numOfHandKind[yourHand] += 1;    //グー、チョキ、パーを出した数
                        your_numOfJudge[yourJudgeCode] += 1;      //勝ち、負け、あいこになった数

                        //勝ちの場合の一連の処理
                        if (yourJudgeCode == JANKEN_JUDGE_WIN) {
                            //直近連勝数を更新し直近連勝数が最大連勝数を超えるようなら
                            //最大連勝数の更新
                            your_numOfLastCombo += 1;
                            if (your_numOfLastCombo > your_numOfMaxCombo) {
                                your_numOfMaxCombo = your_numOfLastCombo;
                            }
                            //通常ポイントアップ
                            your_nomalPoint += 1;
                            //連勝ポイントアップ
                            if (your_numOfLastCombo > 1) {
                                your_comboPoint += your_numOfLastCombo;
                                // your_comboPoint += 1;
                            }
                        }
                        //負けの場合の一連の処理
                        else if (yourJudgeCode == JANKEN_JUDGE_LOSS) {
                            //直近連勝数のリセット
                            your_numOfLastCombo = 0;
                        }
                        //あいこの場合の一連の処理
                        else if (yourJudgeCode == JANKEN_JUDGE_LOSS) {
                            //直近連勝数のリセット
                            your_numOfLastCombo = 0;
                        }

                        //結果の更新
                        $(my_numOfHandKind_Gu_ID).text(my_numOfHandKind[JANKEN_HAND_GU]);
                        $(my_numOfHandKind_Par_ID).text(my_numOfHandKind[JANKEN_HAND_CHOKI]);
                        $(my_numOfHandKind_Choki_ID).text(my_numOfHandKind[JANKEN_HAND_PAR]);
                        $(my_numOfJudge_Win_ID).text(my_numOfJudge[JANKEN_JUDGE_WIN]);
                        $(my_numOfJudge_Loss_ID).text(my_numOfJudge[JANKEN_JUDGE_LOSS]);
                        $(my_numOfJudge_Even_ID).text(my_numOfJudge[JANKEN_JUDGE_DRAW]);
                        $(my_numOfLastCombo_ID).text(my_numOfLastCombo);
                        $(my_numOfMaxCombo_ID).text(my_numOfMaxCombo);
                        $(my_nomalPoint_ID).text(my_nomalPoint);
                        $(my_comboPoint_ID).text(my_comboPoint);
                        $(my_pointSum_ID).text(my_nomalPoint + my_comboPoint);

                        $(my_ratioOfHandKind_Gu_ID).text(
                            Math.floor(my_numOfHandKind[JANKEN_HAND_GU] / JankCount * 100)
                        );
                        $(my_ratioOfHandKind_Par_ID).text(
                            Math.floor(my_numOfHandKind[JANKEN_HAND_CHOKI] / JankCount * 100)
                        );
                        $(my_ratioOfHandKind_Choki_ID).text(
                            Math.floor(my_numOfHandKind[JANKEN_HAND_PAR] / JankCount * 100)
                        );
                        $(my_ratioOfJudge_Win_ID).text(
                            Math.floor(my_numOfJudge[JANKEN_JUDGE_WIN] / JankCount * 100)
                        );
                        $(my_ratioOfJudge_Loss_ID).text(
                            Math.floor(my_numOfJudge[JANKEN_JUDGE_LOSS] / JankCount * 100)
                        );
                        $(my_ratioOfJudge_Even_ID).text(
                            Math.floor(my_numOfJudge[JANKEN_JUDGE_DRAW] / JankCount * 100)
                        );
                        $(my_ratioOfcomboPoint_ID).text(
                            Math.floor(my_comboPoint / (my_nomalPoint + my_comboPoint) * 100)
                        );




                        $(your_numOfHandKind_Gu_ID).text(your_numOfHandKind[JANKEN_HAND_GU]);
                        $(your_numOfHandKind_Par_ID).text(your_numOfHandKind[JANKEN_HAND_CHOKI]);
                        $(your_numOfHandKind_Choki_ID).text(your_numOfHandKind[JANKEN_HAND_PAR]);
                        $(your_numOfJudge_Win_ID).text(your_numOfJudge[JANKEN_JUDGE_WIN]);
                        $(your_numOfJudge_Loss_ID).text(your_numOfJudge[JANKEN_JUDGE_LOSS]);
                        $(your_numOfJudge_Even_ID).text(your_numOfJudge[JANKEN_JUDGE_DRAW]);
                        $(your_numOfLastCombo_ID).text(your_numOfLastCombo);
                        $(your_numOfMaxCombo_ID).text(your_numOfMaxCombo);
                        $(your_nomalPoint_ID).text(your_nomalPoint);
                        $(your_comboPoint_ID).text(your_comboPoint);
                        $(your_pointSum_ID).text(your_nomalPoint + your_comboPoint);

                        $(your_ratioOfHandKind_Gu_ID).text(
                            Math.floor(your_numOfHandKind[JANKEN_HAND_GU] / JankCount * 100)
                        );
                        $(your_ratioOfHandKind_Par_ID).text(
                            Math.floor(your_numOfHandKind[JANKEN_HAND_CHOKI] / JankCount * 100)
                        );
                        $(your_ratioOfHandKind_Choki_ID).text(
                            Math.floor(your_numOfHandKind[JANKEN_HAND_PAR] / JankCount * 100)
                        );
                        $(your_ratioOfJudge_Win_ID).text(
                            Math.floor(your_numOfJudge[JANKEN_JUDGE_WIN] / JankCount * 100)
                        );
                        $(your_ratioOfJudge_Loss_ID).text(
                            Math.floor(your_numOfJudge[JANKEN_JUDGE_LOSS] / JankCount * 100)
                        );
                        $(your_ratioOfJudge_Even_ID).text(
                            Math.floor(your_numOfJudge[JANKEN_JUDGE_DRAW] / JankCount * 100)
                        );
                        $(your_ratioOfcomboPoint_ID).text(
                            Math.floor(your_comboPoint / (your_nomalPoint + your_comboPoint) * 100)
                        );



                        //グラフの更新
                        chart.data.datasets[0].data[0] = my_numOfHandKind[JANKEN_HAND_GU];
                        chart.data.datasets[0].data[1] = my_numOfHandKind[JANKEN_HAND_CHOKI];
                        chart.data.datasets[0].data[2] = my_numOfHandKind[JANKEN_HAND_PAR];
                        chart.data.datasets[0].data[3] = my_numOfJudge[JANKEN_JUDGE_WIN];
                        chart.data.datasets[0].data[4] = my_numOfJudge[JANKEN_JUDGE_LOSS];
                        chart.data.datasets[0].data[5] = my_numOfJudge[JANKEN_JUDGE_DRAW];
                        chart.data.datasets[0].data[6] = my_nomalPoint;
                        chart.data.datasets[0].data[7] = my_comboPoint;
                        chart.data.datasets[0].data[8] = my_nomalPoint + my_comboPoint;

                        chart.data.datasets[1].data[0] = your_numOfHandKind[JANKEN_HAND_GU];
                        chart.data.datasets[1].data[1] = your_numOfHandKind[JANKEN_HAND_CHOKI];
                        chart.data.datasets[1].data[2] = your_numOfHandKind[JANKEN_HAND_PAR];
                        chart.data.datasets[1].data[3] = your_numOfJudge[JANKEN_JUDGE_WIN];
                        chart.data.datasets[1].data[4] = your_numOfJudge[JANKEN_JUDGE_LOSS];
                        chart.data.datasets[1].data[5] = your_numOfJudge[JANKEN_JUDGE_DRAW];
                        chart.data.datasets[1].data[6] = your_nomalPoint;
                        chart.data.datasets[1].data[7] = your_comboPoint;
                        chart.data.datasets[1].data[8] = your_nomalPoint + your_comboPoint;

                        chart.update();

                        chart2.data.datasets[0].data[0] = Math.floor(my_numOfHandKind[JANKEN_HAND_GU] / JankCount * 100);
                        chart2.data.datasets[0].data[1] = Math.floor(my_numOfHandKind[JANKEN_HAND_CHOKI] / JankCount * 100);
                        chart2.data.datasets[0].data[2] = Math.floor(my_numOfHandKind[JANKEN_HAND_PAR] / JankCount * 100);
                        chart2.data.datasets[0].data[3] = Math.floor(my_numOfJudge[JANKEN_JUDGE_WIN] / JankCount * 100);
                        chart2.data.datasets[0].data[4] = Math.floor(my_numOfJudge[JANKEN_JUDGE_LOSS] / JankCount * 100);
                        chart2.data.datasets[0].data[5] = Math.floor(my_numOfJudge[JANKEN_JUDGE_DRAW] / JankCount * 100);

                        chart2.data.datasets[1].data[0] = Math.floor(your_numOfHandKind[JANKEN_HAND_GU] / JankCount * 100);
                        chart2.data.datasets[1].data[1] = Math.floor(your_numOfHandKind[JANKEN_HAND_CHOKI] / JankCount * 100);
                        chart2.data.datasets[1].data[2] = Math.floor(your_numOfHandKind[JANKEN_HAND_PAR] / JankCount * 100);
                        chart2.data.datasets[1].data[3] = Math.floor(your_numOfJudge[JANKEN_JUDGE_WIN] / JankCount * 100);
                        chart2.data.datasets[1].data[4] = Math.floor(your_numOfJudge[JANKEN_JUDGE_LOSS] / JankCount * 100);
                        chart2.data.datasets[1].data[5] = Math.floor(your_numOfJudge[JANKEN_JUDGE_DRAW] / JankCount * 100);


                        chart2.update();


                        //オート間隔
                        await sleep(0.1);

                    }
                    // 総合結果判定
                    if (chart.data.datasets[0].data[8] > chart.data.datasets[1].data[8]) {
                        $('#judgment').text('総合勝利!!');
                    } else if (chart.data.datasets[0].data[8] < chart.data.datasets[1].data[8]) {
                        $('#judgment').text('総合敗北!!');
                    }
                    else {
                        $('#judgment').text('奇跡の総合あいこ!!');
                    }



                    // ランキング更新
                    const player1Name = $('#player1Name').val();
                    const player1Score = my_nomalPoint + my_comboPoint;
                    const player2Name = $('#player2Name').val();
                    const player2Score = your_nomalPoint + your_comboPoint;
                    const rankingData = [
                        {
                            userName: player1Name,
                            totalScore: my_nomalPoint + my_comboPoint,
                        },
                        {
                            userName: player2Name,
                            totalScore: your_nomalPoint + your_comboPoint,
                        },
                    ];

                    // ランキングデータをスコアの高い順にソートする
                    rankingData.sort(function (a, b) {
                        if (a.totalScore > b.totalScore) {
                            return -1;
                        } else {
                            return 1;
                        }
                    });


                    const jsonData = JSON.stringify(rankingData);
                    console.log(rankingData);
                    console.log(jsonData);
                    localStorage.setItem('rankingLocalStrage', jsonData);

                    // 直近プレイヤー情報保存
                    const lastPlayerData = {
                        lastPlayer1: player1Name,
                        lastPlayer2: player2Name
                    }
                    localStorage.setItem('lastPlayerLocalStrage', lastPlayerData);
                })();
            });
        });
    </script>


    <script>
        /********************************
         * シンプル機能
         ********************************/
        $(function () {
            /********************************
             * ジャンケン機能 メイン
             ********************************/
            //三つ同時に判定
            $('#gu_btn, #cho_btn, #par_btn').on('click', function () {

                //クリックされたIDを求める
                let clickID = '#' + $(this).attr("id");
                //デバッグ出力
                console.log('id  ' + clickID);

                //クリックされたIDをJANKEN_HANDとし、それをもとに自分の出した手の表記を変える
                let myHand = ID_TO_JANKEN_HAND[clickID];
                jibunIdToJankenHand(myHand, '#jibun');

                //0-2の乱数をJANKEN_HANDとし、それをもとに相手の出した手の表記を変える
                let yourHand = Math.floor(Math.random() * (max - min + 1)) + min;
                aiteIdToJankenHand(yourHand, '#aite')

                //勝敗判定
                let judge = JANKEN_JUDGE_TEXT_MTX[JANKEN_JUDGE_MTX[myHand][yourHand]];
                $('#judgment').text(judge);

            })
        });
    </script>
    <script>
        //ランキングを見るボタン クリックイベント
        $('#ranking').on('click', function () {
            const jsonData = localStorage.getItem('rankingLocalStrage');
            console.log(jsonData);
            const data = JSON.parse(jsonData);
            console.log(data);

            console.log(data[0].userName);

            $('#rank1_userName').text(data[0].userName);
            $('#rank1_totalScore').text(data[0].totalScore);
            $('#rank2_userName').text(data[1].userName);
            $('#rank2_totalScore').text(data[1].totalScore);


            $('.js-modal').fadeIn();
            return false;
            // const title = $('#input').val();
            // console.log(title);
            // const text = $('#text_area').val();
            // const data = {
            //     title: title,
            //     text: text,
            // };
            // const jsonData = JSON.stringify(data);
            // console.log(data);
            // console.log(jsonData);
            // localStorage.setItem('memo', jsonData);


        });
        $('.js-modal-close').on('click', function () {
            $('.js-modal').fadeOut();
            return false;
        });
        // $(function () {
        //     $('.js-modal-open').on('click', function () {
        //         $('.js-modal').fadeIn();
        //         return false;
        //     });
        //     $('.js-modal-close').on('click', function () {
        //         $('.js-modal').fadeOut();
        //         return false;
        //     });
        // });
    </script>

    <script>
        $(function () {
            //ページ読み込み：保存データ取得表示
            if (localStorage.getItem('lastPlayerLocalStrage')) {
                const text = localStorage.getItem('lastPlayerLocalStrage');
                $('#player1Name').val(text.lastPlayer1);
                $('#player2Name').val(text.lastPlayer2);
            }
        });
    </script>

</body>

</html>